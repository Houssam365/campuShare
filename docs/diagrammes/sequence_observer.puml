@startuml sequence_observer
!theme plain

title Diagramme de S√©quence - Pattern Observer\nSyst√®me de Notifications - CampusShare

actor "Alice\n(Propri√©taire)" as alice
participant "Annonce\n<<Observable>>" as annonce
participant "EmailObserver" as emailObs
participant "PushObserver" as pushObs
participant "SMSObserver" as smsObs
actor "Bob\n(Abonn√©)" as bob
actor "Charlie\n(Abonn√©)" as charlie

== Phase 1: Abonnement aux notifications ==

bob -> annonce : attach(emailObserver)
activate annonce
annonce -> annonce : observers.add(emailObserver)
annonce --> bob : OK
deactivate annonce

bob -> annonce : attach(pushObserver)
activate annonce
annonce -> annonce : observers.add(pushObserver)
annonce --> bob : OK
deactivate annonce

charlie -> annonce : attach(smsObserver)
activate annonce
annonce -> annonce : observers.add(smsObserver)
annonce --> charlie : OK
deactivate annonce

note over annonce
  **√âtat actuel:**
  observers = [emailObs, pushObs, smsObs]
end note

== Phase 2: Modification d√©clenchant les notifications ==

alice -> annonce : setPrixBase(8.00‚Ç¨)
activate annonce

annonce -> annonce : this.prixBase = 8.00‚Ç¨
annonce -> annonce : notifyObservers("Prix modifi√©: 8‚Ç¨")

loop pour chaque observer dans observers
    
    annonce -> emailObs : update(this, "Prix modifi√©: 8‚Ç¨")
    activate emailObs
    emailObs -> bob : [üìß EMAIL]\nSujet: Annonce modifi√©e\nLe prix est maintenant 8‚Ç¨
    emailObs --> annonce : 
    deactivate emailObs
    
    annonce -> pushObs : update(this, "Prix modifi√©: 8‚Ç¨")
    activate pushObs
    pushObs -> bob : [üì± PUSH]\nNouveau prix: 8‚Ç¨
    pushObs --> annonce : 
    deactivate pushObs
    
    annonce -> smsObs : update(this, "Prix modifi√©: 8‚Ç¨")
    activate smsObs
    smsObs -> charlie : [üí¨ SMS]\nCampusShare: Prix modifi√© 8‚Ç¨
    smsObs --> annonce : 
    deactivate smsObs
    
end

annonce --> alice : OK
deactivate annonce

== Phase 3: D√©sabonnement ==

bob -> annonce : detach(pushObserver)
activate annonce
annonce -> annonce : observers.remove(pushObserver)
annonce --> bob : OK
deactivate annonce

note over annonce
  **√âtat actuel:**
  observers = [emailObs, smsObs]
  (pushObs retir√©)
end note

== Phase 4: Nouvelle notification (sans Push) ==

alice -> annonce : changerStatut(RESERVEE)
activate annonce

annonce -> annonce : this.statut = RESERVEE
annonce -> annonce : notifyObservers("Annonce r√©serv√©e")

annonce -> emailObs : update(this, "Annonce r√©serv√©e")
activate emailObs
emailObs -> bob : [üìß EMAIL] Annonce r√©serv√©e
deactivate emailObs

note over pushObs #LightGray
  PushObserver n'est
  plus notifi√©
  (d√©sabonn√©)
end note

annonce -> smsObs : update(this, "Annonce r√©serv√©e")
activate smsObs
smsObs -> charlie : [üí¨ SMS] Annonce r√©serv√©e
deactivate smsObs

annonce --> alice : OK
deactivate annonce

== Avantages du Pattern Observer ==

note over annonce, smsObs
  ‚úì **D√©couplage** : L'annonce ne conna√Æt pas les d√©tails des observateurs
  ‚úì **Extensibilit√©** : Facile d'ajouter un nouveau type (ex: WhatsAppObserver)
  ‚úì **Flexibilit√©** : Abonnement/d√©sabonnement dynamique
  ‚úì **R√©utilisabilit√©** : Les observateurs peuvent observer plusieurs annonces
end note

@enduml
